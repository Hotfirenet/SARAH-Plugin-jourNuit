var JNDebug=false;var JNHeureDuJour="";var JNHeureDeLaNuit="";var JNSetFlag=false;exports.init=function(e){e.context.jourNuit={};var t=e.ConfigManager.getConfig();t=t.modules.jourNuit;jourOuNuit(t.heureDuJour,t.heureDeLaNuit,"",function(t){e.context.jourNuit.status=t});JNHeureDuJour=t.heureDuJour;JNHeureDeLaNuit=t.heureDeLaNuit};exports.action=function(e,t,n,r){if(JNDebug)console.log("01 - action - value context: "+r.context.jourNuit.status);var i="nous sommes en mode "+r.context.jourNuit.status;if(JNDebug){console.log("03 - "+i);console.log("04 - "+e.jourNuitAction);console.log("05 - "+e.status);console.log("06 - "+JNSetFlag)}switch(e.jourNuitAction){case"setJourNuit":setJourOuNuit(e.status,function(e){r.context.jourNuit.status=e;t({tts:e})});break;case"getJourNuit":t({tts:r.context.jourNuit.status});break;case"getMode":if(JNSetFlag)var s="manuel";else var s="normal";t({tts:s});break;default:t({tts:"Action inconnu"});break}};exports.cron=function(e,t,n){jourOuNuit(JNHeureDuJour,JNHeureDeLaNuit,n.context.jourNuit.status,function(e){n.context.jourNuit.status=e})};exports.getJourNuit=function(e){var t=e.context.jourNuit.status;if(JNDebug)console.log("getJourNuit: "+t);return t};var jourOuNuit=function(e,t,n,r){var i="";var s=new Array;s[0]="January";s[1]="February";s[2]="March";s[3]="April";s[4]="May";s[5]="June";s[6]="July";s[7]="August";s[8]="September";s[9]="October";s[10]="November";s[11]="December";var o=new Date;var u=o.getFullYear()+"-"+s[o.getMonth()]+"-"+o.getDate();var a=new Date(u+" "+e);var f=new Date(u+" "+t);if(JNDebug){console.log(o);console.log(u);console.log(a);console.log(f)}if(o>a&&o<f){if(JNSetFlag)i=n;else i="jour"}else{if(JNSetFlag)i=n;else i="nuit"}if(JNDebug)console.log("cron: "+i);r(i);return};var setJourOuNuit=function(e,t){if(JNDebug)console.log("05 - "+e);if(e){var n="";switch(e){case"jour":n="jour";JNSetFlag=true;break;case"nuit":n="nuit";JNSetFlag=true;break;case"normal":if(JNSetFlag){JNSetFlag=false;jourOuNuit(JNHeureDuJour,JNHeureDeLaNuit,"",function(e){n=e})}else n="Le système est déjà en mode normal !";break;default:n="Erreur le level doit etre jour, nuit ou normal !";break}t(n);return}}
